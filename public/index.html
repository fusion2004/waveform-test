<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF8">
  <style>
  body, svg {
    background: #424242;
  }
  </style>
</head>
<body>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="d3.min.js"></script>
  <script src="waveform-data.min.js"></script>
  <script>
    var xhr = new XMLHttpRequest();

    // .dat file generated by audiowaveform program
    xhr.responseType = "arraybuffer";
    xhr.open("GET", "/sample7.dat");
    xhr.addEventListener("load", function onResponse(progressEvent){
      var waveform = WaveformData.create(progressEvent.target);

      var layout = d3.select('body').append("svg")
        .attr("width", "100%");
      var layout2 = d3.select('body').append("svg")
        .attr("width", "100%");
      var svg = $("svg");
      var x = d3.scale.linear();
      var y = d3.scale.linear();
      var offsetX = svg.height()/2;

      x.domain([0, waveform.adapter.length]).range([0, svg.width()]);
      // y.domain([d3.min(waveform.min), d3.max(waveform.max)]).rangeRound([offsetX, -offsetX]);
      y.domain([d3.min(waveform.min), d3.max(waveform.max)]).rangeRound([offsetX, -offsetX]);

      var area = d3.svg.area()
        .x(function(d, i){ return x(i) })
        .y0(function(d, i){
          switch(i % 3) {
            case 0:
              return y(waveform.max[i]);
            case 1:
              return y(waveform.max[i-1]);
            case 2:
              return 0;
          }
        })
        .y1(function(d, i){
          switch(i % 3) {
            case 0:
              return y(waveform.min[i]) / 2;
            case 1:
              return y(waveform.min[i-1]) / 2;
            case 2:
              return 0;
          }
        })
        .interpolate("step-after");

      var defs = layout.append("svg:defs")

      var gradient = defs
        .append("svg:linearGradient")
        .attr("id", "waveGradient")
        .attr("x1", "0%")
        .attr("y1", "0%")
        .attr("x2", "0%")
        .attr("y2", "100%")
        .attr("spreadMethod", "pad");

      var grayGradient = defs
        .append("svg:linearGradient")
        .attr("id", "grayGradient")
        .attr("x1", "0%")
        .attr("y1", "0%")
        .attr("x2", "0%")
        .attr("y2", "100%")
        .attr("spreadMethod", "pad");

      // OPTION NOT PLAYING
      grayGradient.append("svg:stop")
          .attr("offset", "0%")
          .attr("stop-color", "#ddd")
          .attr("stop-opacity", 1);

      grayGradient.append("svg:stop")
          .attr("offset", "65%")
          .attr("stop-color", "#aaa")
          .attr("stop-opacity", 1);

      grayGradient.append("svg:stop")
          .attr("offset", "66%")
          .attr("stop-color", "#aaa")
          .attr("stop-opacity", 0.75);

      grayGradient.append("svg:stop")
          .attr("offset", "100%")
          .attr("stop-color", "#aaa")
          .attr("stop-opacity", 0.33);

      // OPTION AWESOME
      gradient.append("svg:stop")
          .attr("offset", "0%")
          .attr("stop-color", "#F72B2B")
          .attr("stop-opacity", 1);

      gradient.append("svg:stop")
          .attr("offset", "65%")
          .attr("stop-color", "#B30000")
          .attr("stop-opacity", 1);

      gradient.append("svg:stop")
          .attr("offset", "66%")
          .attr("stop-color", "#B30000")
          .attr("stop-opacity", 0.75);

      gradient.append("svg:stop")
          .attr("offset", "100%")
          .attr("stop-color", "#B30000")
          .attr("stop-opacity", 0.33);


      layout.append("path")
        .datum(waveform.max)
        .attr("transform", function(){ return "translate(0, "+offsetX+")"; })
        .attr("d", area)
        // .attr("fill", "#c00");
        .attr('fill', 'url(#waveGradient)');

      layout2.append("path")
        .datum(waveform.max)
        .attr("transform", function(){ return "translate(0, "+offsetX+")"; })
        .attr("d", area)
        // .attr("fill", "#c00");
        .attr('fill', 'url(#grayGradient)');

    });
    xhr.send();
  </script>
</body>
</html>
