<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF8">
</head>
<body>
  <svg><path></path></svg>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="d3.min.js"></script>
  <script src="waveform-data.min.js"></script>
  <script>
    var xhr = new XMLHttpRequest();

    // .dat file generated by audiowaveform program
    xhr.responseType = "arraybuffer";
    xhr.open("GET", "/sample7.dat");
    xhr.addEventListener("load", function onResponse(progressEvent){
      var waveform = WaveformData.create(progressEvent.target);

      var layout = d3.select('body').select("svg")
        .attr("width", "100%")
        // .attr("height", 200)
        .style("border", "1px solid black");
      var svg = $("svg");
      var x = d3.scale.linear();
      var y = d3.scale.linear();
      var offsetX = svg.height()/2;

      x.domain([0, waveform.adapter.length]).range([0, svg.width()]);
      y.domain([d3.min(waveform.min), d3.max(waveform.max)]).rangeRound([offsetX, -offsetX]);

      var area = d3.svg.area()
        .x(function(d, i){ return x(i) })
        .y0(function(d, i){ return y(waveform.min[i]) })
        .y1(function(d, i){ return y(d) });

      layout.select("path")
        .datum(waveform.max)
        .attr("transform", function(){ return "translate(0, "+offsetX+")"; })
        .attr("d", area);

    });
    xhr.send();
  </script>
</body>
</html>
